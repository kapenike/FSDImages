<html>
<!-- import class to interact with API -->
<script src="/api_connection_library.js.php"></script>
<!-- import worker auth token GET['pipe'] REQUIRED-->
<script src="/worker_auth_connection_key.js.php?pipe=example_pipe"></script>
<!-- import custom fonts -->
<link rel="stylesheet" type="text/css" href="/fonts">
<script>

document.addEventListener('DOMContentLoaded', function () {

	// params: project uid | listeners object | event function calls
	const apiserver = new api_server(
		'uid_example', // project uid
		{
			overlays: [],
			data: [],
			pipe: { // 
				key: 'example_pipe',
				token: API_WORKER_AUTH_TOKEN
			}
		},
		{ // event function calls
			open: function (event) {
				console.log('Open event, this script runs before init of API flow.');
				console.log(event);
			},
			message: function (event) {
				
				let data = JSON.parse(event.data);
				
				// send message to pipe clients on declaration
				if (data.identifier) {
					apiserver.writePipe({
						test: 'Any clients awake on "example_pipe"?'
					});
				}
				
				// listen for pipe client responses
				if (data.update && data.update.pipe) {
					console.log(data.update.pipe);
				}
				
			},
			error: function (event) {
				console.log('Error occurred with connection to server.');
				console.log(event);
			},
			close: function (event) {
				console.log('Server shutdown.');
				console.log(event);
			}
		}
	);

});
</script>
<style>
html, body {
	width: 100%;
	height: 100%;
	padding: 0;
	margin: 0;
	font-family: Verdana;
}
</style>
<body>
</body>
</html>